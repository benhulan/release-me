<!DOCTYPE html>
<html lang="en">

<head>
  <% include ../partials/header.ejs %>
</head>

<body>
  <% include ../partials/nav.ejs %>

    <div id="map-canvas" style="margin: 0 auto;"></div>
    <script type="text/javascript"
		src="https://maps.googleapis.com/maps/api/js?sensor=TRUE">
    </script>
    <script type="text/javascript">
		var map;

		function initialize() {
			var mapOptions = {
				center: new google.maps.LatLng(0,0),
				zoom: 8
			};
			
			map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
		  
			if(navigator.geolocation) {
				console.log('navigator.geolocation');
				navigator.geolocation.getCurrentPosition(currentPositionCallback, errorCallback,{enableHighAccuracy: true});
			} else {
				alert('The browser does not support geolocation');
			}
		 
			
			var infowindow = new google.maps.InfoWindow();
		  
		}
      

		function errorCallback(error) {
			alert('code: ' + error.code + '\n' + 'message: ' + error.message);
		}
		
		function currentPositionCallback(position) {
			console.log('getting current position');
			var user_lat_long = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

			document.getElementById('latitude').value = position.coords.latitude;
			document.getElementById('longitude').value = position.coords.longitude;
			document.getElementById('latitudea').value = position.coords.latitude;
			document.getElementById('longitudea').value = position.coords.longitude;
			console.log(document.getElementById('latitude').value);
			console.log(document.getElementById('longitude').value);

			/*
			var marker = new google.maps.Marker({
				position: user_lat_long,
				map: map
			});
			*/

			map.setCenter(user_lat_long);
			map.setZoom(15);
		}

		google.maps.event.addDomListener(window, 'load', initialize);
    </script>

	<script>
      $(function () {

      var $searchBox = $("#search");
      $searchBox.autocomplete({
          source: function (request, response) {
             $.ajax({
                url: "/search_user",
                type: "GET",
                data: request,  // request is the value of search input
                success: function (data) {
                  // Map response values to fiedl label and value
                   response($.map(data, function (el) {
                       console.log(el);
                      return {
                         label: el.local.name,
                         value: el.local.email
                      };
                      }));
                   }
                });
             },
             
             // The minimum number of characters a user must type before a search is performed.
             minLength: 3, 
             
             // set an onFocus event to show the result on input field when result is focused
             focus: function (event, ui) { 
                this.value = ui.item.label; 
                // Prevent other event from not being execute
                event.preventDefault();
             },
             select: function (event, ui) {
                // Prevent value from being put in the input:
                this.value = ui.item.label;
                // Set the id to the next input hidden field
                // $(this).next("input").val(ui.item.value);
                // Prevent other event from not being execute            
                event.preventDefault();
                // optionnal: submit the form after field has been filled up
             }
      });

        });

    </script>

		
    <script type="text/javascript">
        $(document).ready(function() {
            $('#map').addClass("active");
        });
    </script>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- <script src="https://code.jquery.com/jquery.js"></script> -->
    <!-- Latest compiled and minified JavaScript -->
    
</body>
</html>